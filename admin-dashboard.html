<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    
</head>
<body>

<div class="container">

    <!-- LOGIN PAGE -->
    <div id="loginBox" class="box">
        <h3>Login Admin</h3>
        <input id="email" placeholder="Email admin">
        <input id="pass" type="password" placeholder="Password">
        <button onclick="login()">LOGIN</button>
    </div>

    <!-- ADMIN PANEL -->
    <div id="panel" class="box" style="display:none">
        <h3>Tambah File Baru</h3>
        <input id="judul" placeholder="Judul file">
        <input id="foto" placeholder="Link gambar">
        <input id="link" placeholder="Link download">
        <button onclick="addFile()">TAMBAH</button>

        <h3 style="margin-top:20px">Data File</h3>
        <table class="table" id="table"></table>

        <button onclick="logout()" class="logout">LOGOUT</button>
    </div>

</div>

<script>
// ================================
// SUPABASE KONEK
// ================================
const supabase = supabase.createClient(
  "https://sqyftyxqfptggpvwdvlm.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxeWZ0eXhxZnB0Z2dwdndkdmxtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MDU3MDEsImV4cCI6MjA4MDQ4MTcwMX0.TO95Q_mRrp7lfwexCnooVuTKy3fWavRaHFiSvTr6KQs"
);



// ================================
// LOGIN SYSTEM ROLE ADMIN
// ================================
async function login(){
    let email=document.getElementById("email").value.trim();
    let pass=document.getElementById("pass").value.trim();

    const { data:auth, error } = await supabase.auth.signInWithPassword({
        email, password:pass
    });

    if(error) return alert("Email / Password salah!");

    // CEK ROLE (HANYA ADMIN YANG BOLEH MASUK)
    const { data:user } = await supabase
        .from("users")
        .select("role")
        .eq("email",email)
        .single();

    if(!user || user.role !== "admin"){
        await supabase.auth.signOut();
        return alert("Kamu bukan ADMIN!");
    }

    localStorage.setItem("admin","true");
    loadPanel();
}



// AUTO LOGIN (TIDAK DIKICK KALAU REFRESH)
if(localStorage.getItem("admin")) loadPanel();



// ================================
// PANEL ADMIN FUNCTIONS
// ================================
async function loadPanel(){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("panel").style.display="block";
    loadFiles();
}

async function addFile(){
    await supabase.from("files").insert([{
        title:document.getElementById("judul").value,
        image_url:document.getElementById("foto").value,
        file_url:document.getElementById("link").value,
    }]);
    loadFiles();
}

async function loadFiles(){
    let {data}=await supabase.from("files").select("*");
    let t=document.getElementById("table");
    t.innerHTML=`<tr><th>Judul</th><th>Hapus</th></tr>`;
    data.forEach(x=>{
        t.innerHTML+=`
        <tr>
            <td><a href="${x.file_url}" target="_blank">${x.title}</a></td>
            <td><button onclick="del('${x.id}')">HAPUS</button></td>
        </tr>`;
    });
}

async function del(id){
    await supabase.from("files").delete().eq("id",id);
    loadFiles();
}

function logout(){
    localStorage.removeItem("admin");
    location.reload();
}
</script>
</body>
</html>
